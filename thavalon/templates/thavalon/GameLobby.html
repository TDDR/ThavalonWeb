<!DOCTYPE html>
{% csrf_token %}
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Thavalon Home</title>
    <link rel="stylesheet" href="{% static 'thavalon/css/master.css' %}">
    <link rel="stylesheet" href="{% static 'thavalon/css/bootstrap.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.css" />
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="{% static 'thavalon/js/bootstrap.bundle.min.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/js/bootstrap-select.min.js"></script>
    <script>$('select').selectpicker();</script>
    <script src="{% static 'thavalon/js/GameLobby.js' %}"></script>
</head>
<body>

  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="index.html">Home</a>


    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="#">Leave Lobby</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Start Game</a>
        </li>
      </ul>
      <ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex">
        <li class="nav-item">
          <a class="nav-link" href="#">Rules</a>
        </li>
      </ul>
    </div>
  </nav>

  <div class="container pt-5">
    <div class="row">
      <div class="col-12 text-center" id="roleBlurbLocation">
        <!-- role blurb goes here -->
      </div>
    </div>
    <div class="row">
      <div class="col-1"></div>
      <div class="col-2">
        <img src="{% static 'thavalon/images/black-coin.png' %}" height="175px" width="175px" />
      </div>
      <div class="col-2">
        <img src="{% static 'thavalon/images/red-coin.png' %}" height="175px" width="175px"/>
      </div>
      <div class="col-2">
        <img src="{% static 'thavalon/images/black-coin.png' %}" class="img-grayscale" height="175px" width="175px"/>
      </div>
      <div class="col-2">
        <img src="{% static 'thavalon/images/black-coin.png' %}" class="img-grayscale"  height="175px" width="175px"/>
      </div>
      <div class="col-2">
        <img src="{% static 'thavalon/images/black-coin.png' %}" class="img-grayscale"  height="175px" width="175px"/>
      </div>
      <div class="col-1"></div>
    </div>
    <div class="row">

    </div>
  </div>
  <div class="container-fluid pt-3">
     <div class="row">
       <div class="col-12 ">
         <nav>
           <div class="nav nav-tabs nav-fill" id="nav-tab" role="tablist">
             <a class="nav-item nav-link active" id="nav-info-tab" data-toggle="tab" href="#nav-info" role="tab" aria-controls="nav-info" aria-selected="true">My Info</a>
             <a class="nav-item nav-link" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home" aria-selected="true">Shared Chat</a>
             <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false"><!-- proposal/voting --></a>
             <a class="nav-item nav-link" id="nav-about-tab" data-toggle="tab" href="#nav-about" role="tab" aria-controls="nav-about" aria-selected="false">Mission</a>
             <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-contact" role="tab" aria-controls="nav-contact" aria-selected="false">Player Order</a>
           </div>
         </nav>
         <div class="tab-content py-3 px-3 px-sm-0" id="nav-tabContent">
           <div class="tab-pane fade show active" id="nav-info" role="tabpanel" aria-labelledby="nav-info-tab">
             <pre id="roleInformationLocation">
             </pre>
           </div>
           <div class="tab-pane fade" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">

           </div>
           <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
             <pre id="proposalVoteHeader">
               <!-- proposal or vote header here -->
             </pre>
             <pre id="proposalVoteContent">
              <!-- proposal or vote content here -->
             </pre>
           </div>
           <div class="tab-pane fade" id="nav-about" role="tabpanel" aria-labelledby="nav-about-tab">
             <h3>You have been sent on a mission, please select a card:</h3>
             <div class="row">
               <div class="col-2">
                 <img src="{% static 'thavalon/images/black-coin.png' %}" height="175px" width="175px" />
                 Success
               </div>
               <div class="col-2">
                 <img src="{% static 'thavalon/images/red-coin.png' %}" height="175px" width="175px"/>
                 Fail
               </div>
               <div class="col-2">
                 <img src="{% static 'thavalon/images/circle-png.png' %}"height="175px" width="175px"/>
                 Reverse
               </div>
             </div>
           </div>
           <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">
             <ol class="rounded-list" id="playerOrderLocation">
             </ol>
           </div>
         </div>

       </div>
     </div>
   </div>
  <template id="roleBlurbTemplate">
    <span><span></span></span>
  </template>
  <template id="proposerSelectionListTemplate">
    <div class="row">
      <div class="col-md-12">
        <select class="selectpicker" multiple data-live-search="true"></select>
        <button type="button" onclick="toggleTentativeProposal()" href="#">Propose</button>
        <button type="button" onclick="moveToVote()" href="#">Move to Vote</button>
      </div>
    </div>
  </template>
  <script>
    var gameWebSocket = new WebSocket('ws://' + window.location.host +
	    '/ws/thavalon/{{ game_id|escapejs }}/game/');
	gameWebSocket.onmessage = function(e) {
      const data = JSON.parse(e.data);
      if (!data.success) {
        alert(data.errorMessage);
        return;
      }
      switch(data.type) {
        case "gamestate":
            populateGameState(data);
            break;
        case "on_start_game":
            onStartGame(data);
            break;
        case "on_propose":
          onPropose(data);
          break;
        case "on_vote_start":
          onMoveToVote(data);
          break;
        }
      }
    function toggleTentativeProposal() {
      const message = {"type": "propose"};
      message["proposed_player_list"] = $("#proposedPlayerList").val();
      gameWebSocket.send(JSON.stringify(message));
    }

    function moveToVote() {
      const message = {"type": "move_to_vote"}
      const proposedPlayerList = $("#proposedPlayerList").val();
      if (proposedPlayerList == null || proposedPlayerList.length === 0) {
        alert("You must have proposed to select players");
        return;
      }
      message["proposed_player_list"] = proposedPlayerList;
      gameWebSocket.send(JSON.stringify(message));
    }
  </script>
</body>
</html>
